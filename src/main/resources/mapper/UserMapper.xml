<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="sshj.sshj.mapper.UserMapper">

    <!-- 회원가입 유저 정보 등록	-->
    <insert id="insertUser" parameterType="sshj.sshj.dto.UserDto">
        <![CDATA[
		/*	UserMapper.insertUser	*/
		insert into tb_user (
			login_id, password, email, nickname, created_time, role
		) values (
			#{loginId}, #{password}, #{email}, #{nickname}, #{createdTime}, #{role}
		)
	]]>
    </insert>

    <!-- 회원가입 유저 검색	-->
    <select id="selectUserInfo" parameterType="string" resultType="sshj.sshj.dto.UserDto">
        <![CDATA[
		/*	UserMapper.selectUserInfo	*/
		    SELECT
		        user_id as userId,
		        login_id as loginID,
		        password as password,
		        email as email,
		        nickname as nickname,
		        created_time as createdTime,
		        role as role
		    FROM
		        tb_user
		    WHERE
		        login_id = #{loginId}
	    ]]>
    </select>

    <select id="selectUserLoginId" parameterType="string" resultType="int">
        <![CDATA[
		/*	UserMapper.selectUserLoginId	*/
		select count(login_id)
		from tb_user
		where login_id = #{loginId}
	]]>
    </select>

    <select id="selectUserEmail" parameterType="string" resultType="sshj.sshj.dto.UserDto">
        <![CDATA[
		/*	UserMapper.selectUserEmail	*/
		select user_id as userId,
		        login_id as loginID,
		        password as password,
		        email as email,
		        nickname as nickname,
		        created_time as createdTime,
		        role as role
		from tb_user
		where email = #{email}
	]]>
    </select>

    <select id="selectUserNickname" parameterType="string" resultType="int">
        <![CDATA[
		/*	UserMapper.selectUserNickname	*/
		select count(nickname)
		from tb_user
		where nickname = #{nickname}
	]]>
    </select>

    <select id="selectCode" parameterType="string" resultType="sshj.sshj.dto.CodeInfoModel">
        <![CDATA[
		/*	UserMapper.selectCode	*/
		select email as email, created_time as createdTime
		from tb_codeemail
		where code = #{code}
	]]>
    </select>

    <insert id="insertCodeEmail" parameterType="string">
        <![CDATA[
		/*	UserMapper.insertCodeEmail	*/
		insert into tb_codeemail (
			code, email, created_time
		) values (
			#{code}, #{email}, #{time}
		)
	]]>
    </insert>

    <update id="updateCodeEmail" parameterType="string">
        <![CDATA[
			UPDATE tb_user
			SET code=#{code}
			WHERE email=#{email}
		]]>
    </update>

    <update id="updateUserNickname" parameterType="string">
        <![CDATA[
			UPDATE tb_user
			SET nickname=#{nickname}
			WHERE login_id=#{loginId}
		]]>
    </update>

    <update id="updateUserPassword" parameterType="string">
        <![CDATA[
			UPDATE tb_user
			SET password=#{password}
			WHERE login_id=#{loginId}
		]]>
    </update>

</mapper>